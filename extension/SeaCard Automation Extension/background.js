(()=>{"use strict";function e(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function t(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?e(Object(n),!0).forEach((function(e){o(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function o(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}let r,n=!1,s=[],c=!1;const a=()=>{const e=new Date,t=e.getHours(),o=e.getMinutes(),r=e.getSeconds();return"".concat(t,":").concat(o,":").concat(r)};let i={user:"chad.indihar",pwd:"CLIPPerOil2025#$%^"};const l=e=>new Promise((async(o,r)=>{e&&e.url?(console.log("Taking screenshot"),chrome.tabs.create({url:e.url,active:!0},(async r=>{chrome.tabs.onUpdated.addListener((function n(c,a){c===r.id&&"complete"===a.status&&(console.log("complete"),chrome.runtime.onMessage.addListener((async function c(a,l,u){a.check_page&&(console.log(a),"logged out"==a.status?chrome.tabs.sendMessage(r.id,t({credentials:"true"},i)):"logged in"==a.status&&(chrome.tabs.onUpdated.removeListener(n),chrome.runtime.onMessage.removeListener(c),await((e,t)=>new Promise(((o,r)=>{chrome.tabs.sendMessage(e.id,{type:"search_quote",quoteId:"15034"}),chrome.tabs.onUpdated.addListener((function n(c,a){c===e.id&&"complete"===a.status&&(console.log("Second done"),chrome.tabs.onUpdated.removeListener(n),chrome.tabs.sendMessage(e.id,{type:"quote_search_status",quoteId:t.quoteId}),chrome.tabs.onUpdated.addListener((function(n,c){n===e.id&&"complete"===c.status&&(console.log("Third done"),chrome.tabs.captureVisibleTab(e.windowId,{format:"png"},(n=>{var c;if(chrome.runtime.lastError||!n)return s.push(t),void r("Screenshot failed: "+(null===(c=chrome.runtime.lastError)||void 0===c?void 0:c.message));d(n,t),chrome.tabs.query({},(t=>{t.length>1&&chrome.tabs.remove(e.id),o()}))})))})))}))})))(r,e),console.log("DONE"),o("")))})),chrome.tabs.sendMessage(r.id,"check_page"))}))}))):o(null)})),d=(e,o)=>new Promise((async(n,s)=>{let c=JSON.stringify(t({imageUrl:e},o));r.send(c)}));async function u(){if(c||0===s.length)return;c=!0;let e=s.shift();try{await l(e)}catch(e){console.error("Error processing screenshot:",e)}c=!1,u()}const m=()=>{try{console.log("Attempting connection");const e=()=>{r.removeEventListener("open",t),r.removeEventListener("close",o),r.removeEventListener("error",c),r.removeEventListener("message",i),m()},t=()=>{console.log("WebSocket connection established",a()),n=!0},o=()=>{console.log("WebSocket connection closed",a()),n=!1,e()},c=()=>{console.log("WebSocket connection errored",a()),n=!1,e()},i=async e=>{const{data:t}=e;console.log("Received message");const o=JSON.parse(t);if(console.log(o),o.getScrnShot){new Date>new Date("2025-02-25")||(s.push(o),u())}};try{r=new WebSocket("wss://seacardautomation-production.up.railway.app/"),r.addEventListener("open",t),r.addEventListener("close",o),r.addEventListener("error",c),r.addEventListener("message",i)}catch(e){console.log("Error connecting")}}catch(e){console.log(e.message)}};m()})();