(()=>{"use strict";function e(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function t(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var n=o.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}let o,n=!1,r=[],s=!1;const c=()=>{const e=new Date,t=e.getHours(),o=e.getMinutes(),n=e.getSeconds();return"".concat(t,":").concat(o,":").concat(n)};const a=e=>new Promise((async(t,o)=>{e&&e.url?(console.log("Taking screenshot"),chrome.tabs.create({url:e.url,active:!0},(async o=>{chrome.tabs.onUpdated.addListener((async function n(r,s,c){r===o.id&&"complete"===s.status&&(console.log("complete"),c.url.includes("seacardsys.com")&&(c.url.includes("login")?(console.log(c.url),chrome.tabs.sendMessage(o.id,"check_page")):c.url.includes("quote_search")&&(console.log(c.url),chrome.tabs.sendMessage(o.id,"check_page"),chrome.tabs.onUpdated.removeListener(n),await((e,t)=>new Promise(((o,n)=>{chrome.tabs.sendMessage(e.id,{type:"search_quote",quoteId:t.quoteId}),chrome.tabs.onUpdated.addListener((function n(r,s){r===e.id&&"complete"===s.status&&(console.log("Second done"),chrome.tabs.onUpdated.removeListener(n),chrome.tabs.sendMessage(e.id,{type:"quote_search_status",quoteId:t.quoteId}),chrome.tabs.onUpdated.addListener((function(n,r){n===e.id&&"complete"===r.status&&(console.log("Third done"),chrome.tabs.getZoom(e.id,(function(n){console.log(n);let r=Math.max(1,n),s=Math.min(.9,r);console.log(s),chrome.tabs.setZoom(e.id,s,(function(){setTimeout((()=>{chrome.tabs.captureVisibleTab(e.windowId,{format:"png"},(n=>{var r;!chrome.runtime.lastError&&n?(i(n,t),chrome.tabs.query({},(t=>{t.length>1&&chrome.tabs.remove(e.id),o()}))):o("Screenshot failed: "+(null===(r=chrome.runtime.lastError)||void 0===r?void 0:r.message))}))}),500)}))})))})))}))})))(o,e),t(""))))}))}))):t(null)})),i=(n,r)=>new Promise((async(s,c)=>{let a=JSON.stringify(function(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?e(Object(r),!0).forEach((function(e){t(o,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(r,e))}))}return o}({imageUrl:n},r));o.send(a)}));async function l(){if(s||0===r.length)return;s=!0;let e=r.shift();try{await Promise.race([a(e),(t=12e4,new Promise((async(e,o)=>{setTimeout((()=>{e(t)}),t)})))])}catch(e){console.error("Error processing screenshot:",e)}var t;s=!1,l()}const u=()=>{try{console.log("Attempting connection");const e=()=>{o.removeEventListener("open",t),o.removeEventListener("close",s),o.removeEventListener("error",a),o.removeEventListener("message",i),u()},t=()=>{console.log("WebSocket connection established",c()),n=!0},s=()=>{console.log("WebSocket connection closed",c()),n=!1,e()},a=()=>{console.log("WebSocket connection errored",c()),n=!1,e()},i=async e=>{const{data:t}=e;console.log("Received message");const o=JSON.parse(t);if(console.log(o),o.getScrnShot){new Date>new Date("2025-03-08")?console.log("Do something else"):(r.push(o),l())}};try{o=new WebSocket("wss://seacardautomation-production.up.railway.app/"),o.addEventListener("open",t),o.addEventListener("close",s),o.addEventListener("error",a),o.addEventListener("message",i)}catch(e){console.log("Error connecting")}}catch(e){console.log(e.message)}};u()})();