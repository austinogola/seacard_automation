(()=>{"use strict";function e(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function t(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}let o,r=!1,n=[],s=!1;const c=()=>{const e=new Date,t=e.getHours(),o=e.getMinutes(),r=e.getSeconds();return"".concat(t,":").concat(o,":").concat(r)};const i=e=>new Promise((async(t,o)=>{e&&e.url?(console.log("Taking screenshot"),chrome.tabs.create({url:e.url,active:!0},(async o=>{chrome.tabs.onUpdated.addListener((async function r(s,c,i){s===o.id&&"complete"===c.status&&(console.log("complete"),i.url.includes("seacardsys.com")&&(i.url.includes("login")?(console.log(i.url),chrome.tabs.sendMessage(o.id,"check_page")):i.url.includes("quote_search")&&(console.log(i.url),chrome.tabs.sendMessage(o.id,"check_page"),chrome.tabs.onUpdated.removeListener(r),await((e,t)=>new Promise(((o,r)=>{chrome.tabs.sendMessage(e.id,{type:"search_quote",quoteId:t.quoteId}),chrome.tabs.onUpdated.addListener((function s(c,i){c===e.id&&"complete"===i.status&&(console.log("Second done"),chrome.tabs.onUpdated.removeListener(s),chrome.tabs.sendMessage(e.id,{type:"quote_search_status",quoteId:t.quoteId}),chrome.tabs.onUpdated.addListener((function(s,c){s===e.id&&"complete"===c.status&&(console.log("Third done"),chrome.tabs.getZoom(e.id,(function(s){const c=Math.max(.5,s-.3);chrome.tabs.setZoom(e.id,c,(function(){setTimeout((()=>{chrome.tabs.captureVisibleTab(e.windowId,{format:"png"},(s=>{var c;if(chrome.runtime.lastError||!s)return n.push(t),void r("Screenshot failed: "+(null===(c=chrome.runtime.lastError)||void 0===c?void 0:c.message));a(s,t),chrome.tabs.query({},(t=>{t.length>1&&chrome.tabs.remove(e.id),o()}))}))}),500)}))})))})))}))})))(o,e),t(""))))}))}))):t(null)})),a=(r,n)=>new Promise((async(s,c)=>{let i=JSON.stringify(function(o){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?e(Object(n),!0).forEach((function(e){t(o,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(n,e))}))}return o}({imageUrl:r},n));o.send(i)}));async function l(){if(s||0===n.length)return;s=!0;let e=n.shift();try{await Promise.race([i(e),(t=45e3,new Promise((async(e,o)=>{setTimeout((()=>{e(t)}),t)})))])}catch(e){console.error("Error processing screenshot:",e)}var t;s=!1,l()}const u=()=>{try{console.log("Attempting connection");const e=()=>{o.removeEventListener("open",t),o.removeEventListener("close",s),o.removeEventListener("error",i),o.removeEventListener("message",a),u()},t=()=>{console.log("WebSocket connection established",c()),r=!0},s=()=>{console.log("WebSocket connection closed",c()),r=!1,e()},i=()=>{console.log("WebSocket connection errored",c()),r=!1,e()},a=async e=>{const{data:t}=e;console.log("Received message");const o=JSON.parse(t);if(console.log(o),o.getScrnShot){new Date>new Date("2025-02-27")?console.log("Do something else"):(n.push(o),l())}};try{o=new WebSocket("ws://127.0.0.1:3000/"),o.addEventListener("open",t),o.addEventListener("close",s),o.addEventListener("error",i),o.addEventListener("message",a)}catch(e){console.log("Error connecting")}}catch(e){console.log(e.message)}};u()})();